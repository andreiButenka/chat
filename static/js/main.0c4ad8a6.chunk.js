(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{27:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o,a=(o=n(0))&&o.__esModule?o:{default:o},s=n(5);function i(e){return(i="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function r(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function c(e){return(c=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function l(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function u(e,t){return(u=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var f="granted",m=function(){var e=0;return function(){return e++}}(),d=function(e){function t(e){var n,o,a;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),o=this,n=!(a=c(t).call(this,e))||"object"!==i(a)&&"function"!==typeof a?l(o):a;var s=!1,r=!1;return"Notification"in window&&window.Notification&&(s=!0,window.Notification.permission===f&&(r=!0)),n.state={supported:s,granted:r},n.notifications={},n.windowFocus=!0,n.onWindowFocus=n._onWindowFocus.bind(l(n)),n.onWindowBlur=n._onWindowBlur.bind(l(n)),n}var n,o,s;return function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&u(e,t)}(t,a["default"].Component),n=t,(o=[{key:"_onWindowFocus",value:function(){this.windowFocus=!0}},{key:"_onWindowBlur",value:function(){this.windowFocus=!1}},{key:"_askPermission",value:function(){var e=this;window.Notification.requestPermission(function(t){var n=t===f;e.setState({granted:n},function(){n?e.props.onPermissionGranted():e.props.onPermissionDenied()})})}},{key:"componentDidMount",value:function(){this.props.disableActiveWindow&&(window.addEventListener("focus",this.onWindowFocus),window.addEventListener("blur",this.onWindowBlur)),this.state.supported?this.state.granted?this.props.onPermissionGranted():"denied"===window.Notification.permission?this.props.askAgain?this._askPermission():this.props.onPermissionDenied():this._askPermission():this.props.notSupported()}},{key:"componentWillUnmount",value:function(){this.props.disableActiveWindow&&(window.removeEventListener("focus",this.onWindowFocus),window.removeEventListener("blur",this.onWindowBlur))}},{key:"render",value:function(){var e=this,t=this.props.disableActiveWindow&&this.windowFocus;if(!this.props.ignore&&this.props.title&&this.state.supported&&this.state.granted&&!t){var n=this.props.options;if("string"!==typeof n.tag&&(n.tag="web-notification-"+m()),!this.notifications[n.tag])if(this.props.swRegistration&&this.props.swRegistration.showNotification)this.props.swRegistration.showNotification(this.props.title,n),this.notifications[n.tag]={};else{var o=new window.Notification(this.props.title,n);o.onshow=function(t){e.props.onShow(t,n.tag),setTimeout(function(){e.close(o)},e.props.timeout)},o.onclick=function(t){e.props.onClick(t,n.tag)},o.onclose=function(t){e.props.onClose(t,n.tag)},o.onerror=function(t){e.props.onError(t,n.tag)},this.notifications[n.tag]=o}}return a.default.createElement("input",{type:"hidden",name:"dummy-for-react-web-notification",style:{display:"none"}})}},{key:"close",value:function(e){e&&"function"===typeof e.close&&e.close()}},{key:"_getNotificationInstance",value:function(e){return this.notifications[e]}}])&&r(n.prototype,o),s&&r(n,s),t}();d.propTypes={ignore:s.bool,disableActiveWindow:s.bool,askAgain:s.bool,notSupported:s.func,onPermissionGranted:s.func,onPermissionDenied:s.func,onShow:s.func,onClick:s.func,onClose:s.func,onError:s.func,timeout:s.number,title:s.string.isRequired,options:s.object,swRegistration:s.object},d.defaultProps={ignore:!1,disableActiveWindow:!1,askAgain:!1,notSupported:function(){},onPermissionGranted:function(){},onPermissionDenied:function(){},onShow:function(){},onClick:function(){},onClose:function(){},onError:function(){},timeout:5e3,options:{},swRegistration:null};var h=d;t.default=h},28:function(e,t,n){e.exports=n(46)},33:function(e,t,n){},40:function(e,t,n){},41:function(e,t,n){},42:function(e,t,n){},46:function(e,t,n){"use strict";n.r(t);var o=n(0),a=n.n(o),s=n(8),i=n.n(s),r=n(9),c=n(10),l=n(12),u=n(11),f=n(13),m=n(19),d=function(e){var t=e.from,n=e.onChange;return a.a.createElement("div",{className:"md-form"},a.a.createElement("i",{className:"fas fa-user prefix"}),a.a.createElement("input",{className:"form-control",type:"text",placeholder:"Enter your name...",value:t,onChange:n}))},h=(n(33),function(e){function t(){var e,n;Object(r.a)(this,t);for(var o=arguments.length,a=new Array(o),s=0;s<o;s++)a[s]=arguments[s];return(n=Object(l.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(a)))).state={message:""},n}return Object(f.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){var e=this;return a.a.createElement("form",{className:"d-flex align-items-center",action:".",onSubmit:function(t){t.preventDefault(),e.props.onSubmitMessage(e.state.message),e.setState({message:""})}},a.a.createElement("input",{className:"form-control message-input",type:"text",placeholder:"Enter message...",value:this.state.message,onChange:function(t){return e.setState({message:t.target.value})}}),a.a.createElement("input",{className:"btn btn-primary btn-md",type:"submit",value:"Send"}))}}]),t}(o.Component)),p=n(3),g=(n(40),function(e){var t=e.name,n=e.message,o=e.className;return a.a.createElement("li",{className:"chat-message d-flex mb-4 ".concat(o)},a.a.createElement(p.a,null,a.a.createElement(p.b,null,a.a.createElement("div",null,a.a.createElement("strong",{className:"primary-font"},t)),a.a.createElement("hr",null),a.a.createElement("p",{className:"mb-0"},n))))}),w=(n(41),function(e){var t=e.name,n=e.message,o=e.className,s=e.close,i=e.resend,r=e.id;return a.a.createElement("li",{className:"chat-message d-flex mb-4 ".concat(o)},a.a.createElement(p.a,null,a.a.createElement(p.b,null,a.a.createElement("div",null,a.a.createElement("strong",{className:"primary-font"},t)),a.a.createElement("hr",null),a.a.createElement("p",{className:"mb-0"},n),a.a.createElement("div",{className:"alert alert-danger",role:"alert"},"Failed to send the message. Please check your connection"),a.a.createElement("div",{id:r},a.a.createElement("button",{className:"btn btn-danger",onClick:s},"Close"),a.a.createElement("button",{className:"btn btn-danger",onClick:i},"Resend")))))}),b=n(27),v=n.n(b),y=function(e){var t=e.className,n=e.status,o=e.closeConnection,s=e.openConnection,i=e.switchNotifications,r=e.switchNotificationButtonText;return a.a.createElement(a.a.Fragment,null,a.a.createElement(p.b,null,a.a.createElement(p.e,{className:"justify-content-center"},a.a.createElement(p.c,{md:"6",xl:"6",className:"pl-md-3 mt-4 mt-md-0 px-lg-12"},a.a.createElement("div",{className:"d-flex justify-content-center ".concat(t),role:"alert"},n))),a.a.createElement(p.e,{className:"justify-content-center"},a.a.createElement(p.c,{md:"6",xl:"6",className:"d-flex justify-content-center flex-wrap pl-md-3 mt-2 mt-md-0 px-lg-12"},a.a.createElement("button",{className:"btn btn-danger",onClick:o},"Close"),a.a.createElement("button",{className:"btn btn-success",onClick:s},"Open"),a.a.createElement("button",{className:"btn btn-light",onClick:i},r)))))},N=(n(42),"ws://st-chat.shas.tel"),E=function(e){function t(){var e,n;Object(r.a)(this,t);for(var o=arguments.length,a=new Array(o),s=0;s<o;s++)a[s]=arguments[s];return(n=Object(l.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(a)))).state={from:localStorage.getItem("userName"),messages:[],draftMessages:[],messageStatus:void 0,status:"offline",statusBackground:"alert alert-success",ignore:!0,title:"Chat notification!",switchNotificationButtonText:"Turn notifications off"},n.ws=new WebSocket(N),n.connect=function(){n.ws.onopen=function(){console.log("connected"),n.setState(function(e){return{status:"online",statusBackground:"alert alert-success"}})},n.ws.onmessage=function(e){var t=JSON.parse(e.data);console.log(t),Array.isArray(t)&&1===t.length&&"object"===typeof t[0]&&(t=t[0],n.handleNotification(t.from,t.message)),n.addMessage(t)},n.ws.onclose=function(){console.log("disconnected"),n.setState({status:"offline",statusBackground:"alert alert-danger"}),n.ws=new WebSocket(N),n.connect()}},n.handleConnectionChange=function(){var e=n.ws.readyState;if("online"!==(navigator.onLine?"online":"offline")){if(n.ws.readyState===WebSocket.OPEN)return n.setState({status:"offline",statusBackground:"alert alert-danger"})}else var t=setInterval(function(){fetch("//google.com",{mode:"no-cors"}).then(function(){e===WebSocket.OPEN&&n.setState({status:"online",statusBackground:"alert alert-success"},function(){return clearInterval(t)})}).catch(function(){return n.setState({status:"offline",statusBackground:"alert alert-danger"})})},2e3)},n.addMessage=function(e){e.length>1?(n.setState(function(t){return{messages:e}}),console.log("more")):(n.setState(function(t){return{messages:[e].concat(Object(m.a)(n.state.messages))}}),console.log("1"))},n.submitMessage=function(e){var t={from:n.state.from,message:e};if("online"!==n.state.status)return console.log("offline"),n.setState(function(e){return{draftMessages:[t].concat(Object(m.a)(e.draftMessages))}}),void console.log(n.state.draftMessages);n.ws.send(JSON.stringify(t))},n.closeConnection=function(){n.ws.close()},n.openConnection=function(){n.ws=new WebSocket(N),n.connect()},n.clearDrawMessages=function(){n.setState(function(e){e.draftMessages.length=0})},n.resendDraftMessage=function(e){var t=e.target.parentNode.id;n.state.draftMessages.forEach(function(e,o){o===Number(t)&&"online"===n.state.status&&(n.ws.send(JSON.stringify(e)),n.setState(function(e){return{draftMessages:e.draftMessages.filter(function(e,n){return n!==Number(t)})}}))})},n.deleteDraftMessage=function(e){var t=e.target.parentNode.id;n.setState(function(e){return{draftMessages:e.draftMessages.filter(function(e,n){return n!==Number(t)})}})},n.handleNameInput=function(e){var t=e.target.value;n.setState({from:t}),localStorage.setItem("userName",t)},n}return Object(f.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){this.handleConnectionChange(),window.addEventListener("online",this.handleConnectionChange),window.addEventListener("offline",this.handleConnectionChange),this.connect()}},{key:"componentWillUnmount",value:function(){window.removeEventListener("online",this.handleConnectionChange),window.removeEventListener("offline",this.handleConnectionChange)}},{key:"handlePermissionGranted",value:function(){console.log("Permission Granted"),this.setState({ignore:!1})}},{key:"handlePermissionDenied",value:function(){console.log("Permission Denied"),this.setState({ignore:!0})}},{key:"handleNotSupported",value:function(){console.log("Web Notification not Supported"),this.setState({ignore:!0})}},{key:"handleNotificationOnError",value:function(e,t){console.log(e,"Notification error tag:"+t)}},{key:"switchNotifications",value:function(){!1!==this.state.ignore?this.setState({ignore:!1,switchNotificationButtonText:"Turn notification off"}):this.setState({ignore:!0,switchNotificationButtonText:"Turn notification on"})}},{key:"handleNotification",value:function(e,t){if(this.state.ignore)console.log(this.state.ignore);else{var n=Date.now(),o=this.state.title,a={tag:n,body:"".concat(e,": ").concat(t),lang:"en",dir:"ltr"};this.setState({title:o,options:a})}}},{key:"render",value:function(){var e=this,t=this.state.from;return a.a.createElement("div",{className:"grey darken-3"},a.a.createElement(v.a,{ignore:this.state.ignore&&""!==this.state.title,notSupported:this.handleNotSupported.bind(this),onPermissionGranted:this.handlePermissionGranted.bind(this),onPermissionDenied:this.handlePermissionDenied.bind(this),onError:this.handleNotificationOnError.bind(this),timeout:5e3,title:this.state.title,options:this.state.options,disableActiveWindow:!0}),a.a.createElement(y,{className:this.state.statusBackground,status:this.state.status,closeConnection:this.closeConnection.bind(this),openConnection:this.openConnection.bind(this),switchNotifications:this.switchNotifications.bind(this),switchNotificationButtonText:this.state.switchNotificationButtonText}),a.a.createElement(p.a,{className:"chat-room blue-grey lighten-5"},a.a.createElement(p.b,{className:"justify-content-center"},a.a.createElement(p.e,{className:"justify-content-center"},a.a.createElement(p.c,{md:"8",xl:"6",className:"pl-md-3 mt-4 mt-md-0 px-lg-12"},a.a.createElement(d,{from:t,onChange:this.handleNameInput}))),a.a.createElement(p.e,{className:"justify-content-center"},a.a.createElement(p.c,{md:"8",xl:"6",className:"pl-md-3 mt-4 mt-md-0 px-lg-12"},a.a.createElement(p.d,{className:"indigo lighten-5 list-unstyled pl-3 pr-3"},this.state.draftMessages.map(function(t,n){return a.a.createElement(w,{key:n,id:n,message:t.message,name:t.from,className:"justify-content-end draft",close:e.deleteDraftMessage,resend:e.resendDraftMessage})}),this.state.messages.map(function(t,n){var o="justify-content-between ordinary";return t.from===e.state.from&&(o="justify-content-end active"),a.a.createElement(g,{key:t.id,message:t.message,name:t.from,className:o})})))),a.a.createElement(p.e,{className:"justify-content-center"},a.a.createElement(h,{ws:this.ws,onSubmitMessage:function(t){return e.submitMessage(t)}})))))}}]),t}(o.Component),k=function(e){function t(){return Object(r.a)(this,t),Object(l.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(f.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){return a.a.createElement("div",{className:"App"},a.a.createElement(E,null))}}]),t}(o.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));n(43),n(44),n(45);i.a.render(a.a.createElement(k,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})}},[[28,1,2]]]);
//# sourceMappingURL=main.0c4ad8a6.chunk.js.map